<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="gaylong9">



    <meta name="description" content="年更博客 自娱自乐">



<title>Redis_2.数据结构与常用命令 | gaylong9`s blog</title>
<link href="https://cdn.bootcss.com/KaTeX/0.7.1/katex.min.css" rel="stylesheet">



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">gaylong9&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">gaylong9&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Redis_2.数据结构与常用命令</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">gaylong9</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">June 11, 2021&nbsp;&nbsp;17:52:22</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <p> </p>
<a id="more"></a>
<!-- toc -->
<ul>
<li><a href="#1-%E5%AD%97%E7%AC%A6%E4%B8%B2">1. 字符串</a></li>
<li><a href="#2-%E5%93%88%E5%B8%8C">2. 哈希</a></li>
<li><a href="#3-%E9%93%BE%E8%A1%A8">3. 链表</a></li>
<li><a href="#4-%E9%9B%86%E5%90%88">4. 集合</a></li>
<li><a href="#5-%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88">5. 有序集合</a></li>
<li><a href="#6-%E5%9F%BA%E6%95%B0">6. 基数</a></li>
</ul>
<!-- tocstop -->
<p> </p>
<p>实际工作中多个命令应使用SessionCallback接口，本章仅为演示命令，仅使用RedisTemplate完成。</p>
<p> </p>
<h1><span id="1-字符串">1. 字符串</span></h1>
<p>一些常用基本命令：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>set key value</td>
<td>设置键值对</td>
<td>最常用的写入命令</td>
</tr>
<tr>
<td>get key</td>
<td>通过键获取值</td>
<td>最常用的读取命令</td>
</tr>
<tr>
<td>del key</td>
<td>通过key删除键值对</td>
<td>返回删除数；通用，其他结构也可用此命令</td>
</tr>
<tr>
<td>strlen key</td>
<td>求value字符串的长度</td>
<td>返回长度</td>
</tr>
<tr>
<td>getset key value</td>
<td>修改原来的value，并返回旧值</td>
<td></td>
</tr>
<tr>
<td>getrange key start end</td>
<td>获取子串</td>
<td>[start, end]是索引</td>
</tr>
<tr>
<td>append key value</td>
<td>新value加入到原value末尾</td>
<td>返回新value的长度</td>
</tr>
</tbody>
</table>
<p>将键值的序列化器均设置为StringRedisSerializer，可对value以String的形式操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"spring_config.xml"</span>);</span><br><span class="line">RedisTemplate template = context.getBean(RedisTemplate<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="comment">// set</span></span><br><span class="line">template.opsForValue().set(<span class="string">"key2"</span>, <span class="string">"value2"</span>);</span><br><span class="line">template.opsForValue().set(<span class="string">"key3"</span>, <span class="string">"value3"</span>);</span><br><span class="line"><span class="comment">// get</span></span><br><span class="line">String value2 = (String) template.opsForValue().get(<span class="string">"key2"</span>);</span><br><span class="line">System.out.println(value2);</span><br><span class="line"><span class="comment">// del</span></span><br><span class="line">template.delete(<span class="string">"key2"</span>);</span><br><span class="line">value2 = (String) template.opsForValue().get(<span class="string">"key2"</span>);</span><br><span class="line">System.out.println(value2);</span><br><span class="line"><span class="comment">// strlen</span></span><br><span class="line">Long len3 = template.opsForValue().size(<span class="string">"key3"</span>);</span><br><span class="line">System.out.println(len3);</span><br><span class="line"><span class="comment">// getset</span></span><br><span class="line">String oldValue3 = (String) template.opsForValue().getAndSet(<span class="string">"key3"</span>, <span class="string">"newValue3"</span>);</span><br><span class="line">System.out.println(oldValue3);</span><br><span class="line"><span class="comment">// getrange</span></span><br><span class="line">String rangeValue3 = template.opsForValue().get(<span class="string">"key3"</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">System.out.println(rangeValue3);</span><br><span class="line"><span class="comment">// append</span></span><br><span class="line"><span class="keyword">int</span> newLen = template.opsForValue().append(<span class="string">"key3"</span>, <span class="string">"_append"</span>);</span><br><span class="line">System.out.println(newLen);</span><br><span class="line">String newValue3 = (String) template.opsForValue().get(<span class="string">"key3"</span>);</span><br><span class="line">System.out.println(newValue3);</span><br></pre></td></tr></table></figure>
<p>另Redis中数字也用字符串存储，且支持一些简单运算：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>incr key</td>
<td>+1</td>
<td>整数操作</td>
</tr>
<tr>
<td>incrby key increment</td>
<td>+increment</td>
<td>整数操作</td>
</tr>
<tr>
<td>decr key</td>
<td>-1</td>
<td>整数操作</td>
</tr>
<tr>
<td>decrby key decrement</td>
<td>-decrement</td>
<td>整数操作</td>
</tr>
<tr>
<td>incrbyfloat key increment</td>
<td>+increment（浮点数）</td>
<td>浮点数或整数的操作</td>
</tr>
</tbody>
</table>
<p>因为Redis对数字支持很弱，甚至不支持减法和乘除法，一般是Java获取数字后运算再存入Redis。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">template.opsForValue().set(<span class="string">"i"</span>, <span class="string">"8"</span>);</span><br><span class="line">System.out.println((String) template.opsForValue().get(<span class="string">"i"</span>));</span><br><span class="line">template.opsForValue().increment(<span class="string">"i"</span>);</span><br><span class="line">System.out.println((String) template.opsForValue().get(<span class="string">"i"</span>));</span><br><span class="line">template.opsForValue().increment(<span class="string">"i"</span>, <span class="number">1</span>);</span><br><span class="line">System.out.println((String) template.opsForValue().get(<span class="string">"i"</span>));</span><br><span class="line">template.opsForValue().increment(<span class="string">"i"</span>, <span class="number">2.3</span>);</span><br><span class="line">System.out.println((String) template.opsForValue().get(<span class="string">"i"</span>));</span><br><span class="line">template.opsForValue().increment(<span class="string">"i"</span>, -<span class="number">2.3</span>);</span><br><span class="line">System.out.println((String) template.opsForValue().get(<span class="string">"i"</span>));</span><br><span class="line"></span><br><span class="line">template.getConnectionFactory().getConnection().decr(</span><br><span class="line">        template.getKeySerializer().serialize(<span class="string">"i"</span>));</span><br><span class="line">System.out.println((String) template.opsForValue().get(<span class="string">"i"</span>));</span><br><span class="line">template.getConnectionFactory().getConnection().decrBy(</span><br><span class="line">        template.getKeySerializer().serialize(<span class="string">"i"</span>), <span class="number">6</span>);</span><br><span class="line">System.out.println((String) template.opsForValue().get(<span class="string">"i"</span>));</span><br></pre></td></tr></table></figure>
<p>Spring对<code>increment()</code>方法进行重载，支持自增、加整数/浮点数。</p>
<p>减法RedisTemplate没有支持，书中用上述的复杂代码完成，不过用加法的加负数不也可以吗？</p>
<p>且Spring中<code>decr()</code>不支持对浮点数操作。</p>
<p> </p>
<h1><span id="2-哈希">2. 哈希</span></h1>
<p>Redis中的hash是一种数据结构，一个hash结构可以存储2^32-1个键值对。Hash结构的名字可以看作key，通过它找到Hash结构，内部是String类型的field和value的映射表（内部键值对），即一个hash内有多个field和value的映射。</p>
<p>常用命令如下；</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>hdel key field1</td>
<td>删除hash结构中的某个字段</td>
<td>可以多字段删除</td>
</tr>
<tr>
<td>hexists key fileld</td>
<td>判断hash结构中是否存在某个字段</td>
<td>返回1或0</td>
</tr>
<tr>
<td>hgetall key</td>
<td>获取所有键值</td>
<td></td>
</tr>
<tr>
<td>hincrby key field increment</td>
<td>指定某一字段+整数</td>
<td>要求该字段本身为整数</td>
</tr>
<tr>
<td>hincrbyfloat key field increment</td>
<td>某一字段+浮点数</td>
<td>要求字段本身是数字</td>
</tr>
<tr>
<td>hkeys key</td>
<td>返回所有键</td>
<td></td>
</tr>
<tr>
<td>hlen key</td>
<td>键值对数量</td>
<td></td>
</tr>
<tr>
<td>hmget key field1</td>
<td>返回指定键的值</td>
<td></td>
</tr>
<tr>
<td>hmset key field1 value1</td>
<td>hash中设置多个键值对</td>
<td></td>
</tr>
<tr>
<td>hset key field value</td>
<td>hash中设置键值对</td>
<td>对应有hget</td>
</tr>
<tr>
<td>hsetnx key field value</td>
<td>不存在对应field才设置</td>
<td></td>
</tr>
<tr>
<td>hvals key</td>
<td>获取所有value</td>
<td></td>
</tr>
</tbody>
</table>
<p>有几点注意事项：</p>
<ol>
<li>hash结构能存储相当多的键值对，代码中要注意hkeys、hgetall、hvals等获取所有内容的命令</li>
<li>数字的操作，对value有类型要求</li>
</ol>
<p>在Spring中使用hash时，要先设置hashKeySerializer和hashValueSerializer两属性，此处指定默认序列化器<code>&lt;property name=&quot;defaultSerializer&quot; ref=&quot;stringRedisSerializer&quot;/&gt;</code>，随后是Spring的操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">String key = <span class="string">"hash"</span>;</span><br><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">10</span>);</span><br><span class="line">map.put(<span class="string">"f1"</span>, <span class="string">"val1"</span>);</span><br><span class="line">map.put(<span class="string">"f2"</span>, <span class="string">"val2"</span>);</span><br><span class="line"><span class="comment">// hmset</span></span><br><span class="line">template.opsForHash().putAll(key, map);</span><br><span class="line"><span class="comment">// hset</span></span><br><span class="line">template.opsForHash().put(key, <span class="string">"f3"</span>, <span class="string">"3"</span>);</span><br><span class="line"><span class="comment">// hget</span></span><br><span class="line">System.out.println(template.opsForHash().get(key, <span class="string">"f3"</span>));</span><br><span class="line"><span class="comment">// hexists key field</span></span><br><span class="line">System.out.println(template.opsForHash().hasKey(key, <span class="string">"f3"</span>));</span><br><span class="line"><span class="comment">// hgetall</span></span><br><span class="line">Map keyValMap = template.opsForHash().entries(key);</span><br><span class="line">System.out.println(keyValMap.keySet());</span><br><span class="line">System.out.println(keyValMap.values());</span><br><span class="line"><span class="comment">// hincrby</span></span><br><span class="line">template.opsForHash().increment(key, <span class="string">"f3"</span>, <span class="number">2</span>);</span><br><span class="line">System.out.println(template.opsForHash().get(key, <span class="string">"f3"</span>));</span><br><span class="line"><span class="comment">// hincrbyfloat</span></span><br><span class="line">template.opsForHash().increment(key, <span class="string">"f3"</span>, -<span class="number">2.2</span>);</span><br><span class="line">System.out.println(template.opsForHash().get(key, <span class="string">"f3"</span>));</span><br><span class="line"><span class="comment">// hvals</span></span><br><span class="line">List valueList = template.opsForHash().values(key);</span><br><span class="line">System.out.println(valueList);</span><br><span class="line"><span class="comment">// hkeys</span></span><br><span class="line">Set keyList = template.opsForHash().keys(key);</span><br><span class="line">System.out.println(keyList);</span><br><span class="line"><span class="comment">// hmget</span></span><br><span class="line">List valueList2 = template.opsForHash().multiGet(key, keyList);</span><br><span class="line"><span class="comment">// hsetnx</span></span><br><span class="line">System.out.println(template.opsForHash().putIfAbsent(key, <span class="string">"f4"</span>, <span class="string">"val4"</span>));</span><br><span class="line"><span class="comment">// hdel</span></span><br><span class="line">System.out.println(template.opsForHash().delete(key, <span class="string">"f1"</span>, <span class="string">"f2"</span>));</span><br></pre></td></tr></table></figure>
<p> </p>
<h1><span id="3-链表">3. 链表</span></h1>
<p>存储多个字符串，有序的，双向的，能够存储2^32-1个节点。</p>
<p>作为一个双向链表，读性能很差，但插入和删除有优势，故使用时需要对场景甄别，判断是否适合链表。</p>
<p>常用命令：命令分为左右两种，以下以左端命令为主，部分命令有右端形式，改为r即可</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>lpush key node1</td>
<td>左端push</td>
<td>若多个节点，则结果会相反</td>
</tr>
<tr>
<td>rpush key node1</td>
<td>右端push</td>
<td>``</td>
</tr>
<tr>
<td>lindex key index</td>
<td>左侧开始查找索引index的节点</td>
<td>返回节点字符串</td>
</tr>
<tr>
<td>llen key</td>
<td>链表长度，返回节点数</td>
<td></td>
</tr>
<tr>
<td>lpop key</td>
<td>左端第一个节点删除并返回</td>
<td></td>
</tr>
<tr>
<td>linsert key before/after pivot node</td>
<td>在指定值为pivot的节点前后插入新节点</td>
<td>list不存在则报错；没有指定节点返回-1</td>
</tr>
<tr>
<td>lpushx list node</td>
<td>若存在key为list的链表，则插入node</td>
<td></td>
</tr>
<tr>
<td>lrange key start end</td>
<td>[start, end]节点值</td>
<td></td>
</tr>
<tr>
<td>lrem key count value</td>
<td>count=0，则删除所有值为value的节点；否则删除不大于|count|个值为value的节点</td>
<td>返回删除个数</td>
</tr>
<tr>
<td>lset key index node</td>
<td>设置索引index的节点值为node</td>
<td></td>
</tr>
<tr>
<td>ltrim key start stop</td>
<td>只保留[start, stop]的节点</td>
<td></td>
</tr>
</tbody>
</table>
<p>以上命令线程不安全，并发易冲突，有以下阻塞命令，会给链表加锁：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>blpop key timeout</td>
<td>若空，阻塞至超时或有元素</td>
<td></td>
</tr>
<tr>
<td>rpoplpush key src dest</td>
<td>右侧移除，插入到目标链表左侧</td>
<td></td>
</tr>
<tr>
<td>brpoplpush key src dest timeout</td>
<td>可以设置超时时间</td>
<td></td>
</tr>
</tbody>
</table>
<p>以下是Spring中使用：也以左为主</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lpush</span></span><br><span class="line">template.opsForList().leftPush(<span class="string">"list"</span>, <span class="string">"node3"</span>);</span><br><span class="line">List&lt;String&gt; nodes = Arrays.asList(<span class="string">"node2,node"</span>.split(<span class="string">","</span>));</span><br><span class="line">template.opsForList().leftPushAll(<span class="string">"list"</span>, nodes);</span><br><span class="line"><span class="comment">// rpush</span></span><br><span class="line">template.opsForList().rightPush(<span class="string">"list"</span>, <span class="string">"node4"</span>);</span><br><span class="line"><span class="comment">// set</span></span><br><span class="line">template.opsForList().set(<span class="string">"list"</span>, <span class="number">0</span>, <span class="string">"node1"</span>);</span><br><span class="line"><span class="comment">// lindex</span></span><br><span class="line">System.out.println(template.opsForList().index(<span class="string">"list"</span>, <span class="number">0</span>));</span><br><span class="line"><span class="comment">// pop</span></span><br><span class="line">System.out.println(template.opsForList().leftPop(<span class="string">"list"</span>));</span><br><span class="line">System.out.println(template.opsForList().rightPop(<span class="string">"list"</span>));</span><br><span class="line"><span class="comment">// pushx</span></span><br><span class="line">template.opsForList().leftPushIfPresent(<span class="string">"list"</span>, <span class="string">"node1"</span>);</span><br><span class="line">template.opsForList().rightPushIfPresent(<span class="string">"list"</span>, <span class="string">"node4"</span>);</span><br><span class="line"><span class="comment">// llen</span></span><br><span class="line"><span class="keyword">long</span> size = template.opsForList().size(<span class="string">"list"</span>);</span><br><span class="line"><span class="comment">// range</span></span><br><span class="line">System.out.println(template.opsForList().range(<span class="string">"list"</span>, <span class="number">0</span>, size-<span class="number">1</span>));</span><br><span class="line"><span class="comment">// lrem</span></span><br><span class="line">nodes = Arrays.asList(<span class="string">"node,node"</span>.split(<span class="string">","</span>));</span><br><span class="line">template.opsForList().leftPushAll(<span class="string">"list"</span>, nodes);</span><br><span class="line">template.opsForList().remove(<span class="string">"list"</span>, <span class="number">2</span>, <span class="string">"node"</span>);</span><br><span class="line">System.out.println(template.opsForList().range(<span class="string">"list"</span>, <span class="number">0</span>, size-<span class="number">1</span>));</span><br><span class="line"><span class="comment">// linsert较为复杂，需要底层命令</span></span><br><span class="line">template.getConnectionFactory().getConnection().lInsert(</span><br><span class="line">        <span class="string">"list"</span>.getBytes(StandardCharsets.UTF_8),</span><br><span class="line">        RedisListCommands.Position.BEFORE,</span><br><span class="line">        <span class="string">"node2"</span>.getBytes(StandardCharsets.UTF_8),</span><br><span class="line">        <span class="string">"before_node"</span>.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">System.out.println(template.opsForList().range(<span class="string">"list"</span>, <span class="number">0</span>, size-<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// blpop</span></span><br><span class="line">template.opsForList().leftPop(<span class="string">"list"</span>, <span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line"><span class="comment">// rpoplpush</span></span><br><span class="line">template.opsForList().leftPush(<span class="string">"list1"</span>, <span class="string">"node2InL1"</span>);</span><br><span class="line">template.opsForList().leftPush(<span class="string">"list1"</span>, <span class="string">"node1inL1"</span>);</span><br><span class="line">System.out.println(template.opsForList().range(<span class="string">"list"</span>, <span class="number">0</span>, <span class="number">10</span>));</span><br><span class="line">System.out.println(template.opsForList().range(<span class="string">"list1"</span>, <span class="number">0</span>, <span class="number">10</span>));</span><br><span class="line">template.opsForList().rightPopAndLeftPush(<span class="string">"list1"</span>, <span class="string">"list"</span>, <span class="number">1000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">System.out.println(template.opsForList().range(<span class="string">"list"</span>, <span class="number">0</span>, <span class="number">10</span>));</span><br><span class="line">System.out.println(template.opsForList().range(<span class="string">"list1"</span>, <span class="number">0</span>, <span class="number">10</span>));</span><br><span class="line"></span><br><span class="line">template.delete(<span class="string">"list"</span>);</span><br><span class="line">template.delete(<span class="string">"list1"</span>);</span><br></pre></td></tr></table></figure>
<p> </p>
<h1><span id="4-集合">4. 集合</span></h1>
<p>集合同样是哈希表结构，同样理论存储2^32-1个元素，故集合中的操作复杂度都是O(1)。它有三个特点：无序、不重复、每个元素都是String结构。</p>
<p>Redis还可以对多个集合操作，如交差并集。</p>
<p>常用命令如下：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>sadd key member1</td>
<td>增加成员</td>
<td></td>
</tr>
<tr>
<td>scard key</td>
<td>统计成员数</td>
<td></td>
</tr>
<tr>
<td>sdiff key1 [key2]</td>
<td>两集合差集</td>
<td>若一个集合，就返回所有元素</td>
</tr>
<tr>
<td>sdiffstore des key1 [key2]</td>
<td>sdiff的结果保存到des集合</td>
<td></td>
</tr>
<tr>
<td>sinter key1 [key2]</td>
<td>交集</td>
<td>同sdiff</td>
</tr>
<tr>
<td>sinterstore des key1 [key2]</td>
<td></td>
<td></td>
</tr>
<tr>
<td>sismember key member</td>
<td></td>
<td>是返回1；不是返回0</td>
</tr>
<tr>
<td>smembers key</td>
<td>返回所有成员</td>
<td></td>
</tr>
<tr>
<td>smove src des member</td>
<td>将一个成员从src迁移到des集合</td>
<td></td>
</tr>
<tr>
<td>spop key</td>
<td>随机弹出一个元素</td>
<td></td>
</tr>
<tr>
<td>srandmember key [count]</td>
<td>随机返回一个或多个元素，|count|限制总数</td>
<td>count不填默认1，大于总数就返回整个集合</td>
</tr>
<tr>
<td>srem key member1</td>
<td>移除元素</td>
<td></td>
</tr>
<tr>
<td>sunion key1 [key2]</td>
<td>并集</td>
<td>单key返回所有元素</td>
</tr>
<tr>
<td>sunionstore des key1 [key2]</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Spring中使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Set set = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">// sadd</span></span><br><span class="line">template.boundSetOps(<span class="string">"set1"</span>).add(<span class="string">"v1"</span>, <span class="string">"v2"</span>);</span><br><span class="line">template.boundSetOps(<span class="string">"set2"</span>).add(<span class="string">"v0"</span>, <span class="string">"v1"</span>);</span><br><span class="line"><span class="comment">// scard</span></span><br><span class="line">template.opsForSet().size(<span class="string">"set1"</span>);</span><br><span class="line"><span class="comment">// sdiff</span></span><br><span class="line">set = template.opsForSet().difference(<span class="string">"set1"</span>, <span class="string">"set2"</span>);</span><br><span class="line"><span class="comment">// sinter</span></span><br><span class="line">set = template.opsForSet().intersect(<span class="string">"set1"</span>, <span class="string">"set2"</span>);</span><br><span class="line"><span class="comment">// sismember</span></span><br><span class="line"><span class="keyword">boolean</span> exits = template.opsForSet().isMember(<span class="string">"set1"</span>, <span class="string">"v1"</span>);</span><br><span class="line"><span class="comment">// smembers</span></span><br><span class="line">set = template.opsForSet().members(<span class="string">"set1"</span>);</span><br><span class="line"><span class="comment">// spop</span></span><br><span class="line">String val = (String) template.opsForSet().pop(<span class="string">"set1"</span>);</span><br><span class="line"><span class="comment">// srandmember</span></span><br><span class="line">val = (String) template.opsForSet().randomMember(<span class="string">"set1"</span>);</span><br><span class="line">List list = template.opsForSet().randomMembers(<span class="string">"set1"</span>, <span class="number">2</span>);</span><br><span class="line"><span class="comment">// srem</span></span><br><span class="line">template.opsForSet().remove(<span class="string">"set1"</span>, <span class="string">"v1"</span>);</span><br><span class="line"><span class="comment">// sunion</span></span><br><span class="line">template.opsForSet().union(<span class="string">"set1"</span>, <span class="string">"set2"</span>);</span><br><span class="line"><span class="comment">// sdiffstore</span></span><br><span class="line">template.opsForSet().differenceAndStore(<span class="string">"set1"</span>, <span class="string">"set2"</span>, <span class="string">"diff_set"</span>);</span><br></pre></td></tr></table></figure>
<p> </p>
<h1><span id="5-有序集合">5. 有序集合</span></h1>
<p>zset</p>
<p>与无序集合的区别就是每个元素还有一个“分数”，是一个浮点数，Redis利用该分数排序。有序集合同样元素唯一、String类型、hash结构，但分数可以相同。元素除了值、分数，还有key属性，由其标示属于哪个集合。</p>
<p>基础命令：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>zadd key score1 value1</td>
<td>增加成员</td>
<td>无key则创建zset</td>
</tr>
<tr>
<td>zcard key</td>
<td>获取成员数</td>
<td></td>
</tr>
<tr>
<td>zcount key min max</td>
<td>根据分数返回成员个数</td>
<td>默认包含端点，在分数前加“(”表示不包含</td>
</tr>
<tr>
<td>zincrby key increment member</td>
<td>给值为member的成员加increment</td>
<td></td>
</tr>
<tr>
<td>zinterstore desKey numkeys key1</td>
<td>交集，保存至desKey</td>
<td>numKeys表示有几个集合</td>
</tr>
<tr>
<td>zlexcount key min max</td>
<td>指定值的区间内成员数量</td>
<td>“[”表示包含，“(”不包含</td>
</tr>
<tr>
<td>zrange key start stop [withscores]</td>
<td>按分数升序返回成员，可用start stop限制范围；withscores协同分数一起返回</td>
<td>包含两端</td>
</tr>
<tr>
<td>zrank key member</td>
<td>求索引</td>
<td></td>
</tr>
<tr>
<td>zrangebylex key min max [limit offset count]</td>
<td>按值升序排列，随后（按索引限制）返回成员</td>
<td>“[”包含，“(”不包含</td>
</tr>
<tr>
<td>zrangebyscore key min max [withscores] [limit offset count]</td>
<td>根据分数求范围</td>
<td></td>
</tr>
<tr>
<td>zremrangebyscore key start stop</td>
<td>根据分数区间删除</td>
<td>按分数排序</td>
</tr>
<tr>
<td>zremrangebyrank key start stop</td>
<td>按分数升序删除</td>
<td></td>
</tr>
<tr>
<td>zremrangebylex key min max</td>
<td>按值删除</td>
<td></td>
</tr>
<tr>
<td>zrevrange key start stop [withscores]</td>
<td>降序排序</td>
<td></td>
</tr>
<tr>
<td>zrevrangebyscore key max min [withscores]</td>
<td></td>
<td></td>
</tr>
<tr>
<td>zrevrank key member</td>
<td></td>
<td></td>
</tr>
<tr>
<td>zscore key member</td>
<td>返回成员分数</td>
<td></td>
</tr>
<tr>
<td>zunionstore desKey numKeys key1</td>
<td>并集</td>
<td></td>
</tr>
</tbody>
</table>
<p>zset使用频率不高，使用时要注意区分值和分数。</p>
<p>Spring内部定义了TypedTuple内部接口，内有<code>getValue()</code> <code>getScore()</code>两方法。默认实现类是DefaultTypedTuple，默认情况下Spring把值和分数封装进这个类。</p>
<p>另外Spring还对范围进行了封装，RedisZSetCommands的内部类Range，有静态<code>range()</code>方法，用其生成Range对象，有几个方法，常用的有以下四个：</p>
<ol>
<li>大于等于 <code>Range get(min)</code></li>
<li>大于 <code>Range ge(min)</code></li>
<li>小于等于 <code>Range lte(max)</code></li>
<li>小于 <code>Range lt(max)</code></li>
</ol>
<p>限制也有实现类，是RedisZSetCommands的内部类，是一个简单POJO，有offset和count两属性。</p>
<p>部分Spring使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;ZSetOperations.TypedTuple&gt; set1 = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">Set&lt;ZSetOperations.TypedTuple&gt; set2 = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = <span class="number">9</span>; i&lt;=<span class="number">9</span>; i++) &#123;</span><br><span class="line">    j--;</span><br><span class="line">    Double score1 = (<span class="keyword">double</span>) i;</span><br><span class="line">    String value1 = <span class="string">"x"</span> + i;</span><br><span class="line">    Double score2 = (<span class="keyword">double</span>) j;</span><br><span class="line">    String value2 = j % <span class="number">2</span> == <span class="number">1</span>? <span class="string">"y"</span> + j: <span class="string">"x"</span> + j;</span><br><span class="line">    ZSetOperations.TypedTuple typedTuple1 = <span class="keyword">new</span> DefaultTypedTuple(value1, score1);</span><br><span class="line">    set1.add(typedTuple1);</span><br><span class="line">    TypedTuple typedTuple2 = <span class="keyword">new</span> DefaultTypedTuple(value2, score2);</span><br><span class="line">    set2.add(typedTuple2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// zadd</span></span><br><span class="line">template.opsForZSet().add(<span class="string">"zset1"</span>, set1);</span><br><span class="line">template.opsForZSet().add(<span class="string">"zset2"</span>, set2);</span><br><span class="line"><span class="comment">// zcard</span></span><br><span class="line">Long size = template.opsForZSet().zCard(<span class="string">"zset1"</span>);</span><br><span class="line"><span class="comment">// zcount min max, &lt;=score&lt;=</span></span><br><span class="line">size = template.opsForZSet().count(<span class="string">"zset1"</span>, <span class="number">3</span>, <span class="number">6</span>);</span><br><span class="line"><span class="comment">// zrange 不返回分数</span></span><br><span class="line">Set set = template.opsForZSet().range(<span class="string">"zset1"</span>, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">System.out.println(set);</span><br><span class="line"><span class="comment">// zrange withscores</span></span><br><span class="line">set = template.opsForZSet().rangeWithScores(<span class="string">"zset1"</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">System.out.println(set);</span><br><span class="line"><span class="comment">// 区间 zrangebylex</span></span><br><span class="line">RedisZSetCommands.Range range = RedisZSetCommands.Range.range();</span><br><span class="line">range.lt(<span class="string">"x8"</span>);</span><br><span class="line">range.gt(<span class="string">"x1"</span>);</span><br><span class="line">set = template.opsForZSet().rangeByLex(<span class="string">"zset1"</span>, range);</span><br><span class="line">System.out.println(set);</span><br><span class="line"><span class="comment">// 限制</span></span><br><span class="line">RedisZSetCommands.Limit limit = RedisZSetCommands.Limit.limit();</span><br><span class="line">limit.count(<span class="number">4</span>);</span><br><span class="line">limit.offset(<span class="number">5</span>);</span><br><span class="line">set = template.opsForZSet().rangeByLex(<span class="string">"zset1"</span>, range, limit);</span><br><span class="line"><span class="comment">// zrank</span></span><br><span class="line">Long rank = template.opsForZSet().rank(<span class="string">"zset1"</span>, <span class="string">"x4"</span>);</span><br></pre></td></tr></table></figure>
<p> </p>
<h1><span id="6-基数">6. 基数</span></h1>
<p>HyperLogLog</p>
<p>是一种算法，不是存储的数据。优点是在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定的、并且是很小的。每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基 数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>pfadd key element</td>
<td>add</td>
<td>已存储过返回0</td>
</tr>
<tr>
<td>pfcount key</td>
<td>基数值</td>
<td></td>
</tr>
<tr>
<td>pfmerge deskey key1</td>
<td>合并</td>
<td></td>
</tr>
</tbody>
</table>
<p>Spring中其方法都是<code>opsForHyperLogLog()</code>的方法，有<code>add()</code> <code>size()</code> <code>union()</code>，使用不多，不再赘述。</p>
<p> </p>

        </div>

        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E5%90%8E%E7%AB%AF/"># 后端</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2021/06/13/Redis-3-%E4%B8%BB%E8%A6%81%E6%8A%80%E6%9C%AF/">Redis_3.主要技术</a>
            
            
            <a class="next" rel="next" href="/2021/06/09/Redis-1-%E5%9F%BA%E7%A1%80/">Redis_1.基础</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© gaylong9 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!-- <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script> -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.8/unpacked/MathJax.js?config=TeX-MML-AM_CHTML"></script>



<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
