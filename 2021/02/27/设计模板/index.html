<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="gaylong9">



    <meta name="description" content="年更博客 自娱自乐">



<title>设计模板 | gaylong9`s blog</title>
<link href="https://cdn.bootcss.com/KaTeX/0.7.1/katex.min.css" rel="stylesheet">



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">gaylong9&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">gaylong9&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">设计模板</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">gaylong9</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">February 27, 2021&nbsp;&nbsp;20:53:45</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <p> </p>
<a id="more"></a>
<!-- toc -->
<ul>
<li><a href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E6%9D%BF">设计模板</a>
<ul>
<li><a href="#1-%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E6%A8%A1%E6%9D%BF">1. 如何设计模板</a></li>
<li><a href="#2-%E8%B4%9F%E8%B4%A3%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%9A%84servlet">2. 负责流程控制的Servlet</a></li>
<li><a href="#3-%E6%A8%A1%E6%9D%BF%E6%A0%87%E7%AD%BE%E5%92%8C%E6%A8%A1%E6%9D%BFjsp">3. 模板标签和模板JSP</a>
<ul>
<li><a href="#31-parameter%E6%A0%87%E7%AD%BE%E5%92%8C%E5%A4%84%E7%90%86%E7%B1%BB">3.1 &lt;parameter&gt;标签和处理类</a></li>
<li><a href="#32-screen%E6%A0%87%E7%AD%BE%E5%92%8C%E5%A4%84%E7%90%86%E7%B1%BB">3.2 &lt;screen&gt;标签和处理类</a></li>
<li><a href="#33-definition%E6%A0%87%E7%AD%BE%E5%92%8C%E5%A4%84%E7%90%86%E7%B1%BB">3.3 &lt;definition&gt;标签和处理类</a></li>
<li><a href="#34-insert%E6%A0%87%E7%AD%BE%E5%92%8C%E5%A4%84%E7%90%86%E7%B1%BB">3.4 &lt;insert&gt;标签和处理类</a></li>
<li><a href="#35-%E9%85%8D%E7%BD%AE">3.5 配置</a></li>
</ul>
</li>
<li><a href="#4-%E4%BF%AE%E6%94%B9%E8%B0%83%E6%95%B4%E5%85%B6%E4%BD%99jsp">4. 修改/调整其余JSP</a></li>
<li><a href="#5-%E7%9B%AE%E5%BD%95">5. 目录</a></li>
<li><a href="#6-%E6%B5%81%E7%A8%8B%E6%80%BB%E7%BB%93">6. 流程总结</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<p> </p>
<p>[toc]</p>
<h1><span id="设计模板">设计模板</span></h1>
<p>为使网站页面风格统一，可通过自定义JSP标签为网站设计模板。所有在客户端战士的页面都通过模板生成。由此，提高开发效率，便于维护，修改模板即可实现批量网页修改。</p>
<p>实际运用中，已有现成框架软件，通常不需从头设计模板。</p>
<h2><span id="1-如何设计模板">1. 如何设计模板</span></h2>
<ol>
<li>先找出所有网页在结构和内容上的相同之处，把相同之处定义在模板中，模板本身也常是JSP文件。如bookstore中，每个页面都是title+body（banner、body）结构，故可定义template.jsp作为模板。当接收到请求时，template.jsp中的自定义标签可以根据客户的请求，把具体的title、banner、body填充进去，生成所需网页</li>
<li>所有客户请求都由DispatcherServlet类处理，将请求的具体URL保存在请求范围中，再把请求转发给template.jsp。jsp从请求范围读取请求URL，根据请求生成相关网页</li>
<li>综上，设计模板时，包含以下内容：
<ol>
<li>创建负责流程控制的Servlet：DispatcherServlet</li>
<li>创建模板标签和模板JSP文件。本例中创建4个标签：<code>&lt;definition&gt; &lt;screen&gt; &lt;insert&gt; &lt;parameter&gt;</code>；<code>template.jsp</code>和<code>screendefinitions.jsp</code>用来生成所有网页的模板</li>
<li>修改/创建其他JSP，仅负责生成模板中的body部分内容</li>
</ol>
</li>
</ol>
<p> </p>
<h2><span id="2-负责流程控制的servlet">2. 负责流程控制的Servlet</span></h2>
<p>所有请求都由DispatcherServlet类处理，把请求的URL作为selectScreen属性存放在请求范围，转发请求给template.jsp。template.jsp中的自定义标签再从请求范围中读取selectScreen属性，把具体的title、body内容填充进去，生成所需网页</p>
<ol>
<li>
<p>DispatcherServlet</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 把请求的URL存入req</span></span><br><span class="line">        req.setAttribute(<span class="string">"selectedScreen"</span>, req.getServletPath().substring(<span class="number">1</span>));</span><br><span class="line">        req.getRequestDispatcher(<span class="string">"/template.jsp"</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>客户请求URL：<code>req.getServletPath().substring(1)</code>，若请求URL为<code>/bookdetails</code>，则此代码返回<code>bookdetails</code></p>
</li>
<li>
<p>为使得所有请求都首先由DispatcherServlet处理，要在web.xml中为本类配置mapping元素</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>utils.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/enter<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/catalog<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/bookdetails<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/showcart<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/cashier<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/receipt<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>此外，还要修改各JSP中的链接：如</p>
<p><code>&lt;a href=&quot;&lt;%request.getContextPath()%&gt;/catalog.jsp&quot;&gt;</code></p>
<p>要改成<code>&lt;a href=&quot;&lt;%request.getContextPath()%&gt;/catalog&quot;&gt;</code>（或EL表达式<code>&lt;a href=&quot;${pageContext.request.contextPath}/catalog&quot;</code>），如此客户点击此链接时，请求就会先被DispatcherServlet接收。</p>
<p>总之，就是所有链接，都要mapping，且JSP中链接对应。</p>
<p><img src="/2021/02/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E6%9D%BF/JSP%E4%B8%8EDispatcherServlet.jpg" alt="JSP与DispatcherServlet"></p>
</li>
</ol>
<p> </p>
<h2><span id="3-模板标签和模板jsp">3. 模板标签和模板JSP</span></h2>
<ol>
<li>
<p>template.jsp</p>
 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">"/mytaglib"</span> prefix=<span class="string">"mm"</span>%&gt;</span><br><span class="line">&lt;%@ page errorPage=<span class="string">"errorpage.jsp"</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.util.*"</span> %&gt;</span><br><span class="line">&lt;%@ include file=<span class="string">"screendefinitions.jsp"</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;&lt;mm:insert definition="bookstore" parameter="title"/&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;mm:insert definition=<span class="string">"bookstore"</span> parameter=<span class="string">"banner"</span>/&gt;</span><br><span class="line">    &lt;mm:insert definition=<span class="string">"bookstore"</span> parameter=<span class="string">"body"</span>/&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>定义了所有网页的基本布局，由title banner body三部分组成。<code>&lt;mm:insert&gt;</code>标签能根据请求，填充相应内容</p>
</li>
<li>
<p>template.jsp中根据客户请求决定网页具体内容：模板jsp中include了screendefinitions.jsp，该文件负责根据请求决定网页具体内容</p>
<p>screendefinitions.jsp：</p>
 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;mm:definition name=<span class="string">"bookstore"</span> screenId=<span class="string">"$&#123;requestScope.selectedScreen&#125;"</span> screenNum=<span class="string">"6"</span>&gt;</span><br><span class="line">       &lt;mm:screen id=<span class="string">"enter"</span>&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"title"</span> value=<span class="string">"Bookstore"</span> direct=<span class="string">"true"</span>/&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"banner"</span> value=<span class="string">"/banner.jsp"</span> direct=<span class="string">"false"</span>/&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"body"</span> value=<span class="string">"/bookstore.jsp"</span> direct=<span class="string">"false"</span>/&gt;</span><br><span class="line">        &lt;/mm:screen&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;mm:screen id=<span class="string">"catalog"</span>&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"title"</span> value=<span class="string">"BookCatalog"</span> direct=<span class="string">"true"</span>/&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"banner"</span> value=<span class="string">"/banner.jsp"</span> direct=<span class="string">"false"</span>/&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"body"</span> value=<span class="string">"/catalog.jsp"</span> direct=<span class="string">"false"</span>/&gt;</span><br><span class="line">        &lt;/mm:screen&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;mm:screen id=<span class="string">"bookdetails"</span>&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"title"</span> value=<span class="string">"BookDescription"</span> direct=<span class="string">"true"</span>/&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"banner"</span> value=<span class="string">"/banner.jsp"</span> direct=<span class="string">"false"</span>/&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"body"</span> value=<span class="string">"/bookdetails.jsp"</span> direct=<span class="string">"false"</span>/&gt;</span><br><span class="line">        &lt;/mm:screen&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;mm:screen id=<span class="string">"showcart"</span>&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"title"</span> value=<span class="string">"ShoppingCart"</span> direct=<span class="string">"true"</span>/&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"banner"</span> value=<span class="string">"/banner.jsp"</span> direct=<span class="string">"false"</span>/&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"body"</span> value=<span class="string">"/showcart.jsp"</span> direct=<span class="string">"false"</span>/&gt;</span><br><span class="line">        &lt;/mm:screen&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;mm:screen id=<span class="string">"cashier"</span>&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"title"</span> value=<span class="string">"Cashier"</span> direct=<span class="string">"true"</span>/&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"banner"</span> value=<span class="string">"/banner.jsp"</span> direct=<span class="string">"false"</span>/&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"body"</span> value=<span class="string">"/cashier.jsp"</span> direct=<span class="string">"false"</span>/&gt;</span><br><span class="line">        &lt;/mm:screen&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;mm:screen id=<span class="string">"receipt"</span>&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"title"</span> value=<span class="string">"Receipt"</span> direct=<span class="string">"true"</span>/&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"banner"</span> value=<span class="string">"/banner.jsp"</span> direct=<span class="string">"false"</span>/&gt;</span><br><span class="line">                &lt;mm:parameter name=<span class="string">"body"</span> value=<span class="string">"/receipt.jsp"</span> direct=<span class="string">"false"</span>/&gt;</span><br><span class="line">        &lt;/mm:screen&gt;</span><br><span class="line">&lt;/mm:definition&gt;</span><br></pre></td></tr></table></figure>
<p>包含多个嵌套标签：</p>
<p>​	<code>&lt;definition&gt;</code>定义了客户所请求的某个具体网页的内容。DispatcherServlet把请求URL作为selectedScreen存入请求范围，在screendefinitions.jsp中又从请求范围读取该属性，赋值给<code>&lt;definition&gt;</code>标签的screenID属性</p>
<p>​	<code>&lt;screen&gt;</code>用于预定义一个网页的完整具体内容，本例中banner都对应banner.jsp，body对应bookstore、bookdetails、catalog、showcart、cashier和receipt几个JSP</p>
<p>​	<code>&lt;paramter&gt;</code>定义网页中title、banner或body对应的内容</p>
<p>​	<code>&lt;insert&gt;</code>负责把客户请求的网页的各项内容填充到模板中</p>
</li>
</ol>
<h3><span id="31-ltparametergt标签和处理类">3.1 &lt;parameter&gt;标签和处理类</span></h3>
<ol>
<li>
<p>本标签定义了网页中的某一部分的内容，有3个属性：</p>
<ol>
<li>name：在网页中所处位置，可选值对应本例中模板网页的三部分“title”，“banner”，“body”</li>
<li>value：设定具体内容，对应name，给出所需的字符串或JSP文件</li>
<li>direct：制定此项内容是否可以直接网页输出，如title true，其余部分false；与<code>&lt;insert&gt;</code>标签配合，根据此属性决定输出方法，如字符串就直接输出到网页，若是JSP就包含到模板文件中</li>
</ol>
</li>
<li>
<p>本标签采用Parameter类保存所有属性</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parameter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isDirect;</span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Parameter</span><span class="params">(String name, String value, <span class="keyword">boolean</span> isDirect)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.isDirect = isDirect;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDirect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.isDirect;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// getName getValue</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>标签处理类ParameterTag：doStartTag中构造一个Parameter对象，将属性值存入，并将其保存到名为parameters的ArrayList中，这个List作为属性保存在父级标签中，本例中是ScreenTag</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParameterTag</span> <span class="keyword">extends</span> <span class="title">TagSupport</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String paramName = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> String paramValue = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> String isDirectString = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ParameterTag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3属性set()</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doStartTag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> isDirect = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.isDirectString != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.isDirectString.toLowerCase().equals(<span class="string">"true"</span>)) &#123;</span><br><span class="line">            isDirect = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.paramName != <span class="keyword">null</span>) &#123;</span><br><span class="line">                ArrayList parameters = (ArrayList)((TagSupport)<span class="keyword">this</span>.getParent()).getValue(<span class="string">"parameters"</span>);</span><br><span class="line">                <span class="keyword">if</span> (parameters != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    Parameter param = <span class="keyword">new</span> Parameter(<span class="keyword">this</span>.paramName, <span class="keyword">this</span>.paramValue, isDirect);</span><br><span class="line">                    parameters.add(param);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var4) &#123;</span><br><span class="line">            var4.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.paramName = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.paramValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.isDirectString = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">super</span>.release();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>本例中，screendefinitions.jsp中，每个<code>&lt;screen&gt;</code>标签包含3个<code>&lt;parameter&gt;</code>标签，分别代表了一个网页中title、banner、body，当3个<code>&lt;parameter&gt;</code>标签处理结束后，父级ScreenTag对象中的parameters就保存了3个Parameter对象</p>
</li>
<li>
<p>set/getValue()是TagSupport中的方法</p>
</li>
</ol>
<p> </p>
<h3><span id="32-ltscreengt标签和处理类">3.2 &lt;screen&gt;标签和处理类</span></h3>
<p>本例中，screendefinitions.jsp中定义了6个<code>&lt;screen&gt;</code>标签，分别代表了本例所实现的6个网页。<code>&lt;screen&gt;</code>标签是<code>&lt;definition&gt;</code>的子标签，又是<code>&lt;parameter&gt;</code>的父标签</p>
<ol>
<li>
<p>本标签预定义了某个网页的各部分内容，有一个属性id，用于标识网页名</p>
</li>
<li>
<p>处理类ScreenTag，在doStartTag中，创建一个ArrayList，并setValue将它作为parameters属性保存起来，随后从Web应用范围内取得HashMap类型的screens对象，将id作为key，parameters作为value保存进去</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScreenTag</span> <span class="keyword">extends</span> <span class="title">TagSupport</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ScreenTag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doStartTag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setValue(<span class="string">"parameters"</span>, <span class="keyword">new</span> ArrayList());</span><br><span class="line">        HashMap screens = (HashMap)<span class="keyword">this</span>.pageContext.getAttribute(<span class="string">"screens"</span>, pageContext.APPLICATION_SCOPE);</span><br><span class="line">        <span class="keyword">if</span> (screens == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!screens.containsKey(<span class="keyword">this</span>.getId())) &#123;</span><br><span class="line">            screens.put(<span class="keyword">this</span>.getId(), <span class="keyword">this</span>.getValue(<span class="string">"parameters"</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.release();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p> </p>
<h3><span id="33-ltdefinitiongt标签和处理类">3.3 &lt;definition&gt;标签和处理类</span></h3>
<ol>
<li>
<p>本标签根据客户请求，决定输出的网页内容</p>
</li>
<li>
<p>共有3属性：</p>
<ol>
<li>name：标识当前Definition对象</li>
<li>screenId：指定网页名字，属性值由客户请求的URL决定，来自DispatcherServlet处理后存入req内的selectedScreen</li>
<li>screenNum：标识Web应用中所有向客户展示的网页的数目，即本标签下<code>&lt;screen&gt;</code>子标签的数目</li>
</ol>
</li>
<li>
<p>采用Definition类保存网页各部分内容</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Definition</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;String, Parameter&gt; params = <span class="keyword">new</span> HashMap();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Definition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParam</span><span class="params">(Parameter p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.params.put(p.getName(), p);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Parameter <span class="title">getParam</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Parameter)<span class="keyword">this</span>.params.get(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一个Definition对象代表客户请求的一个网页，包含1个params对象，内含3个Parameter对象，分别代表本例中的title、banner、body。</p>
</li>
<li>
<p>标签处理类DefinitionTag，doStartTag中，先判断Web应用范围中有无screens对象，不存在就创建。screens中保存了应用的所有网页的内容，并且会判断是否已满（放够了页面，本例为6），满后跳过标签主体/子标签；doEndTag中，从Web应用范围去的screens对象，再从中取得与客户请求的screenId对应的parameters对象，在这个parameters中存放了客户所需网页；随后将这个parameters封装到一个Definition对象中，存入page范围</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefinitionTag</span> <span class="keyword">extends</span> <span class="title">TagSupport</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String definitionName = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> String screenId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> screenNum;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DefinitionTag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3 set()</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doStartTag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HashMap screens = <span class="keyword">null</span>;</span><br><span class="line">        screens = (HashMap)<span class="keyword">this</span>.pageContext.getAttribute(<span class="string">"screens"</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">if</span> (screens == <span class="keyword">null</span>) &#123;</span><br><span class="line">            pageContext.setAttribute(<span class="string">"screens"</span>, var2, pageContext.APPLICATION_SCOPE);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (screens.size() == <span class="keyword">this</span>.screenNum) &#123;</span><br><span class="line">            <span class="keyword">return</span> SKIP_BODY;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> EVAL_BODY_INCLUDE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doEndTag</span><span class="params">()</span> <span class="keyword">throws</span> JspTagException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Definition definition = <span class="keyword">new</span> Definition();</span><br><span class="line">            HashMap screens = <span class="keyword">null</span>;</span><br><span class="line">            ArrayList parameters = <span class="keyword">null</span>;</span><br><span class="line">            TagSupport screen = <span class="keyword">null</span>;</span><br><span class="line">            screens = (HashMap)<span class="keyword">this</span>.pageContext.getAttribute(<span class="string">"screens"</span>, pageContext.APPLICATION_SCOPE);</span><br><span class="line">            <span class="keyword">if</span> (screens != <span class="keyword">null</span>) &#123;</span><br><span class="line">                parameters = (ArrayList)screens.get(<span class="keyword">this</span>.screenId);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Iterator ir = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (parameters != <span class="keyword">null</span>) &#123;</span><br><span class="line">                ir = parameters.iterator();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(ir != <span class="keyword">null</span> &amp;&amp; ir.hasNext()) &#123;</span><br><span class="line">                definition.setParam((Parameter)ir.next());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.pageContext.setAttribute(<span class="keyword">this</span>.definitionName, definition);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var6) &#123;</span><br><span class="line">            var6.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> EVAL_PAGE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.definitionName = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.screenId = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">super</span>.release();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>DefinitionTag和Definition对象流程图</p>
<p><img src="/2021/02/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E6%9D%BF/DefinitionTag%E5%92%8CDefinition%E5%AF%B9%E8%B1%A1.jpg" alt="DefinitionTag和Definition对象"></p>
</li>
</ol>
<p> </p>
<h3><span id="34-ltinsertgt标签和处理类">3.4 &lt;insert&gt;标签和处理类</span></h3>
<p>本标签在template.jsp中，用于将网页的某部分内容填充到模板中，生成客户所需页面。 如<code>&lt;mm:insert definition=&quot;bookstore&quot; parameter=&quot;title&quot; /&gt;</code></p>
<ol>
<li>
<p>两个属性：</p>
<ol>
<li>definition：指定存放在page范围内的Definition对象的属性名</li>
<li>parameter：指定具体的Parameter对象名</li>
</ol>
</li>
<li>
<p>处理类 InsertTag：</p>
<ol>
<li>
<p>doStartTag中，根据definition属性，从page范围内获取Definition对象，包含了当前客户请求的网页的内容，然后根据parameter属性从Definition对象中取得Parameter对象，包含了网页中某部分的信息，本例中title、banner、body，各自对应一个Parameter对象</p>
</li>
<li>
<p>doEndTag，把Parameter对象的内容插入到template.jsp中；若Parameter的direct属性为true，则直接输出到网页；若direct是false，则表示对应一个JSP，就要include到模板JSP</p>
</li>
<li>
<p>InsertTag</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InsertTag</span> <span class="keyword">extends</span> <span class="title">TagSupport</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> directInclude = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> String parameterName = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> String definitionName = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> Definition definition = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> Parameter parameter = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">InsertTag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// definition parameter  2 set</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doStartTag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.definition = (Definition)<span class="keyword">this</span>.pageContext.getAttribute(<span class="keyword">this</span>.definitionName);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.parameterName != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.definition != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.parameter = <span class="keyword">this</span>.definition.getParam(<span class="keyword">this</span>.parameterName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.parameter != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.directInclude = <span class="keyword">this</span>.parameter.isDirect();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doEndTag</span><span class="params">()</span> <span class="keyword">throws</span> JspTagException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.directInclude &amp;&amp; <span class="keyword">this</span>.parameter != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.pageContext.getOut().print(<span class="keyword">this</span>.parameter.getValue());</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.parameter != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.parameter.getValue() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.pageContext.include(<span class="keyword">this</span>.parameter.getValue());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> EVAL_PAGE;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> JspTagException(var2.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.directInclude = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.parameterName = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.definitionName = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.definition = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.parameter = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">super</span>.release();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E6%9D%BF/InsertTag%E5%90%91%E6%A8%A1%E6%9D%BFJSP%E6%8F%92%E5%85%A5%E5%86%85%E5%AE%B9.jpg" alt="InsertTag向模板JSP插入内容"></p>
</li>
</ol>
</li>
</ol>
<p> </p>
<h3><span id="35-配置">3.5 配置</span></h3>
<ol>
<li>
<p>mytaglib.tld</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">taglib</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tlib-version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">tlib-version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">jsp-version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">jsp-version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">short-name</span>&gt;</span>mytaglib<span class="tag">&lt;/<span class="name">short-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uri</span>&gt;</span>/mytaglib<span class="tag">&lt;/<span class="name">uri</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span>	</span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>definition<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>mytaglib.DefinitionTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>JSP<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>screenId<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>screenNum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>false<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>screen<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>mytaglib.ScreenTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>JSP<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>id<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>parameter<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>mytaglib.ParameterTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>JSP<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>value<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>direct<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>insert<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>mytaglib.InsertTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>JSP<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>definition<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>parameter<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">taglib</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>web.xml</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jsp-config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">taglib</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">taglib-uri</span>&gt;</span>/mytaglib<span class="tag">&lt;/<span class="name">taglib-uri</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">taglib-location</span>&gt;</span>/WEB-INF/mytaglib.tld<span class="tag">&lt;/<span class="name">taglib-location</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">taglib</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jsp-config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p> </p>
<h2><span id="4-修改调整其余jsp">4. 修改/调整其余JSP</span></h2>
<p>当使用模板时，除template.jsp外，其余JSP不能单独构成网页，均是模板中的部分内容。故：</p>
<ol>
<li>title部分是String类型，不需专门JSP</li>
<li>本例中，建立banner.jsp，专门用于各页面banner部分</li>
<li>所以其余JSP，均是作为模板的body部分，故应删去各JSP的title、banner部分</li>
<li>此外，为保证请求的URL都能有DispatcherServlet接收，要修改JSP中的URL链接，将链接标签中的/xxx.jsp改为/xxx</li>
</ol>
<p> </p>
<h2><span id="5-目录">5. 目录</span></h2>
<ol>
<li>DispatcherServlet：webapp/WEB-INF/classes/mypack</li>
<li>标签处理类和相关类：webapp/WEB-INF/classes/mytaglib</li>
<li>JSP：webapp/</li>
<li>mytaglib.tld：webapp/WEB-INF</li>
</ol>
<p> </p>
<h2><span id="6-流程总结">6. 流程总结</span></h2>
<p><img src="/2021/02/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E6%9D%BF/%E6%A8%A1%E6%9D%BF%E6%B5%81%E7%A8%8B.jpg" alt="模板流程"></p>

        </div>

        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E5%90%8E%E7%AB%AF/"># 后端</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2021/02/27/JSTL%E6%A0%87%E7%AD%BE%E5%BA%93/">JSTL标签库</a>
            
            
            <a class="next" rel="next" href="/2021/02/27/EL%E8%A1%A8%E8%BE%BE%E5%BC%8F/">EL表达式</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© gaylong9 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!-- <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script> -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.8/unpacked/MathJax.js?config=TeX-MML-AM_CHTML"></script>



<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
